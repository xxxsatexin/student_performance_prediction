{% extends "base.html" %}

{% block title %}可视化分析 - 学生成绩预测系统{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">数据可视化分析</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        以下是基于学生数据和模型训练结果的可视化分析，帮助您更好地理解学生成绩分布和影响因素。
                    </div>
                    
                    <ul class="nav nav-tabs mb-4" id="visualizationTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
                                <i class="fas fa-chart-pie me-2"></i>总览
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="distribution-tab" data-bs-toggle="tab" data-bs-target="#distribution" type="button" role="tab" aria-controls="distribution" aria-selected="false">
                                <i class="fas fa-chart-area me-2"></i>成绩分布
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="features-tab" data-bs-toggle="tab" data-bs-target="#features" type="button" role="tab" aria-controls="features" aria-selected="false">
                                <i class="fas fa-chart-bar me-2"></i>特征分析
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="model-tab" data-bs-toggle="tab" data-bs-target="#model" type="button" role="tab" aria-controls="model" aria-selected="false">
                                <i class="fas fa-brain me-2"></i>模型评估
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="correlation-tab" data-bs-toggle="tab" data-bs-target="#correlation" type="button" role="tab" aria-controls="correlation" aria-selected="false">
                                <i class="fas fa-project-diagram me-2"></i>相关性分析
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="visualizationTabContent">
                        <!-- 总览 -->
                        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card h-100">
                                        <div class="card-header bg-light">
                                            <h5 class="mb-0">成绩分布概览</h5>
                                        </div>
                                        <div class="card-body text-center">
                                            <img src="{{ image_paths.grade_distribution }}" alt="成绩分布图" class="img-fluid">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card h-100">
                                        <div class="card-header bg-light">
                                            <h5 class="mb-0">特征重要性</h5>
                                        </div>
                                        <div class="card-body text-center">
                                            <img src="{{ image_paths.feature_importance }}" alt="特征重要性图" class="img-fluid">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">模型评估概览</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered">
                                            <thead class="table-primary">
                                                <tr>
                                                    <th>模型</th>
                                                    <th>RMSE</th>
                                                    <th>MAE</th>
                                                    <th>R²</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for model_name, metrics in evaluation_results.items() %}
                                                <tr>
                                                    <td>{{ model_name }}</td>
                                                    <td>{{ metrics.rmse | round(3) }}</td>
                                                    <td>{{ metrics.mae | round(3) }}</td>
                                                    <td>{{ metrics.r2 | round(3) }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 成绩分布 -->
                        <div class="tab-pane fade" id="distribution" role="tabpanel" aria-labelledby="distribution-tab">
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">学生成绩分布</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img src="{{ image_paths.grade_distribution }}" alt="成绩分布图" class="img-fluid">
                                    <div class="mt-3">
                                        <p>该图展示了学生成绩的分布情况，包括平均分、中位数和标准差等统计信息。通过分析成绩分布，可以了解学生整体学习情况和成绩差异。</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">预测值与实际值对比</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img src="{{ image_paths.prediction_vs_actual }}" alt="预测值与实际值对比图" class="img-fluid">
                                    <div class="mt-3">
                                        <p>该图对比了模型预测的成绩与学生实际成绩，红色虚线表示完美预测线。点越接近该线，表示预测越准确。通过该图可以直观评估模型的预测准确性。</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">残差分析</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img src="{{ image_paths.residuals }}" alt="残差图" class="img-fluid">
                                    <div class="mt-3">
                                        <p>残差是实际值与预测值之间的差异。上图显示了残差与预测值的关系，下图显示了残差的分布情况。理想情况下，残差应该随机分布在零附近，且呈正态分布。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 特征分析 -->
                        <div class="tab-pane fade" id="features" role="tabpanel" aria-labelledby="features-tab">
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">特征重要性分析</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img src="{{ image_paths.feature_importance }}" alt="特征重要性图" class="img-fluid">
                                    <div class="mt-3">
                                        <p>该图展示了各个特征对预测结果的重要性排名。特征重要性越高，表示该特征对预测学生成绩的影响越大。通过分析特征重要性，可以了解哪些因素对学生成绩影响最大。</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card mb-4">
                                        <div class="card-header bg-light">
                                            <h5 class="mb-0">特征与目标变量的相关性</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="alert alert-info">
                                                <i class="fas fa-lightbulb me-2"></i>
                                                <strong>解读：</strong> 根据特征重要性分析，以下因素对学生成绩影响较大：
                                                <ul>
                                                    <li>以往考试成绩：过去的学习表现是预测未来成绩的重要指标</li>
                                                    <li>学习时间：投入更多学习时间通常与更好的成绩相关</li>
                                                    <li>出勤率：定期参加课堂对学习效果有积极影响</li>
                                                    <li>作业完成情况：按时完成作业有助于巩固知识</li>
                                                </ul>
                                                教师可以根据这些关键因素，有针对性地调整教学策略和提供学生支持。
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 模型评估 -->
                        <div class="tab-pane fade" id="model" role="tabpanel" aria-labelledby="model-tab">
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">模型性能对比</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered">
                                            <thead class="table-primary">
                                                <tr>
                                                    <th>模型</th>
                                                    <th>RMSE</th>
                                                    <th>MAE</th>
                                                    <th>R²</th>
                                                    <th>训练时间(秒)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for model_name, metrics in evaluation_results.items() %}
                                                <tr>
                                                    <td>{{ model_name }}</td>
                                                    <td>{{ metrics.rmse | round(3) }}</td>
                                                    <td>{{ metrics.mae | round(3) }}</td>
                                                    <td>{{ metrics.r2 | round(3) }}</td>
                                                    <td>{{ metrics.train_time | default(0) | round(3) }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <p><strong>评估指标说明：</strong></p>
                                        <ul>
                                            <li><strong>RMSE (均方根误差)：</strong> 预测值与实际值差异的平方根，越小越好</li>
                                            <li><strong>MAE (平均绝对误差)：</strong> 预测值与实际值绝对差异的平均值，越小越好</li>
                                            <li><strong>R² (决定系数)：</strong> 模型解释的方差比例，越接近1越好</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">预测值与实际值对比</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img src="{{ image_paths.prediction_vs_actual }}" alt="预测值与实际值对比图" class="img-fluid">
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">模型分析结论</h5>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i>
                                        <strong>最佳模型：</strong> 
                                        {% set best_model = None %}
                                        {% set best_r2 = -1 %}
                                        {% for model_name, metrics in evaluation_results.items() %}
                                            {% if metrics.r2 > best_r2 %}
                                                {% set best_model = model_name %}
                                                {% set best_r2 = metrics.r2 %}
                                            {% endif %}
                                        {% endfor %}
                                        {{ best_model }} (R² = {{ best_r2 | round(3) }})
                                    </div>
                                    
                                    <p>根据模型评估结果，我们可以得出以下结论：</p>
                                    <ul>
                                        <li>模型能够较好地预测学生成绩，R²值表明模型能解释大部分成绩变异</li>
                                        <li>预测误差在可接受范围内，可以为教学决策提供有价值的参考</li>
                                        <li>模型性能可能通过进一步的特征工程和参数调优得到提升</li>
                                    </ul>
                                    
                                    <p><strong>应用建议：</strong></p>
                                    <ul>
                                        <li>利用模型预测识别可能需要额外支持的学生</li>
                                        <li>根据特征重要性，有针对性地调整教学策略</li>
                                        <li>定期更新模型，以适应新的学生数据和教学环境</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 相关性分析 -->
                        <div class="tab-pane fade" id="correlation" role="tabpanel" aria-labelledby="correlation-tab">
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">特征相关性矩阵</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img src="{{ image_paths.correlation_matrix }}" alt="相关性矩阵热图" class="img-fluid">
                                    <div class="mt-3">
                                        <p>相关性矩阵热图展示了各特征之间的相关关系。颜色越深表示相关性越强，红色表示正相关，蓝色表示负相关。通过分析特征间的相关性，可以了解哪些特征之间存在关联，有助于特征选择和模型解释。</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">关键发现</h5>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info">
                                        <i class="fas fa-lightbulb me-2"></i>
                                        <strong>相关性分析发现：</strong>
                                        <ul>
                                            <li>学习时间与成绩呈正相关，表明投入更多学习时间通常会获得更好的成绩</li>
                                            <li>出勤率与成绩呈正相关，说明定期参加课堂对学习效果有积极影响</li>
                                            <li>以往考试成绩与最终成绩高度相关，是预测未来表现的重要指标</li>
                                            <li>作业完成情况与成绩呈正相关，表明按时完成作业有助于巩固知识</li>
                                        </ul>
                                    </div>
                                    
                                    <p><strong>教学建议：</strong></p>
                                    <ol>
                                        <li>鼓励学生增加有效学习时间，提供时间管理指导</li>
                                        <li>强调课堂出勤的重要性，提高课堂教学质量和吸引力</li>
                                        <li>关注学生的阶段性考试表现，对表现下滑的学生及时干预</li>
                                        <li>设计有意义的作业，并确保学生按时完成</li>
                                        <li>为学习困难的学生提供个性化支持和辅导</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
